<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Solar sail · OptimalControl.jl</title><meta name="title" content="Solar sail · OptimalControl.jl"/><meta property="og:title" content="Solar sail · OptimalControl.jl"/><meta property="twitter:title" content="Solar sail · OptimalControl.jl"/><meta name="description" content="Documentation for OptimalControl.jl."/><meta property="og:description" content="Documentation for OptimalControl.jl."/><meta property="twitter:description" content="Documentation for OptimalControl.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">OptimalControl.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="tutorial-basic-example.html">Basic example</a></li><li><a class="tocitem" href="tutorial-basic-example-f.html">Basic example (functional version)</a></li><li><a class="tocitem" href="tutorial-double-integrator.html">Double integrator: time minimisation</a></li><li><a class="tocitem" href="tutorial-initial-guess.html">Initial guess options</a></li><li><a class="tocitem" href="tutorial-continuation.html">Discrete continuation</a></li><li><a class="tocitem" href="tutorial-nlp.html">NLP and DOCP manipulations</a></li><li><a class="tocitem" href="tutorial-plot.html">Plot a solution</a></li><li><a class="tocitem" href="tutorial-lqr-basic.html">LQR example</a></li><li><a class="tocitem" href="tutorial-iss.html">Indirect simple shooting</a></li><li><a class="tocitem" href="tutorial-goddard.html">Goddard problem</a></li></ul></li><li><span class="tocitem">Applications</span><ul><li><a class="tocitem" href="application-batch.html">Batch processing</a></li><li><a class="tocitem" href="application-orbit.html">Minimum time orbit transfer</a></li><li class="is-active"><a class="tocitem" href="application-sail.html">Solar sail</a></li><li><a class="tocitem" href="application-surface-revolution.html">Catenoid solution</a></li><li><a class="tocitem" href="application-mri-saturation.html">MRI: saturation problem</a></li></ul></li><li><a class="tocitem" href="fgs-2024.html">FGS 2024</a></li><li><a class="tocitem" href="juliacon2024.html">JuliaCon 2024</a></li><li><a class="tocitem" href="api.html">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Applications</a></li><li class="is-active"><a href="application-sail.html">Solar sail</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="application-sail.html">Solar sail</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/control-toolbox/OptimalControl.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/control-toolbox/OptimalControl.jl/blob/main/docs/src/application-sail.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="sail"><a class="docs-heading-anchor" href="#sail">Solar sail</a><a id="sail-1"></a><a class="docs-heading-anchor-permalink" href="#sail" title="Permalink"></a></h1><img src="./assets/sail.png" style="display: block; margin: 0 auto 20px auto;" width="400px"><img src="./assets/esa.jpg" style="display: block; margin: 0 auto 20px auto;" width="400px"><img src="./assets/sail2.png" style="display: block; margin: 0 auto 20px auto;" width="400px"><pre><code class="language-julia hljs">using OptimalControl
using NLPModelsIpopt
using Plots
using Interpolations
using JLD2

include(&quot;kepl2cart.jl&quot;)
include(&quot;control_ideal2D.jl&quot;)

function rnorm(x; ε=1e-9)
    return sqrt(sum(x.^2) + ε^2)
end

# Definition of the optical parameters
rho = 0.88 # Specular reflection coefficient
eps_f = 0.05 # Emissivity front coeff
eps_b = 0.55 # Emissivity back coeff

# Solar and space constants
LU = 1.495978707e11  # (m) Astronautical unit
mu = 1  # m^3/s^2
TU = sqrt(LU^3/132712440042e9) # Time Unit
Cs = 1367 * TU^3  # W m^-2 solar flux at 1AU
Tds = 3  # K temperature of the Deep Space
sigma = 5.67051e-8 * TU^3  # Stefan-Boltzmann&#39;s constant [W / m^2 /K^4]
light_speed = 299792458 / LU * TU # Speed of light

# Sail parameters
Am = 45 / LU^2  # Area-to-mass ratio
Area = 20 * 6 / LU^2 # Vane area * quantity of vanes
mass = Area / Am  # Mass of the satellite
temp0 = 293.15  # Initial temperature of the satellite
Csrp = Cs / light_speed
epsilon = Am * Csrp

# Initial orbit data
rpsail = 0.15                     # Periapsis distance elliptic orbit
a0 = (1 + rpsail) /2
e0 = 1 - rpsail/a0
r0, v0 = kepl2cart(a0, e0, 1e-6, 0, 0, 0, mu)
x0 = [r0[1:2]; v0[1:2]]                 # Initial state

# Heat parameters for Kapton material
spec_heat = 989 / LU^2 * TU^2                     # J/kg/K
heat_cap = spec_heat * mass / LU^2 * TU^2        # J/K
Tlim = 800                                   # K
temp_constr = Tds^4 - Tlim^4 #Tlim^4 - Tds^4

opt_constr = (1 - rho)/(eps_f + eps_b)
heat_constr = Cs/sigma

# Integration
t0 = 0
tf = 3600 * 24 * 30 * 12 * 3.5 / TU

# Read of the initial guess from Matlab
filename = &quot;matrix.txt&quot;
file = open(filename, &quot;r&quot;)
file_content = read(file, String)
close(file)
lines = split(file_content, &quot;\n&quot;)
matrix_data = []
for line in lines
    if !isempty(line)
        row = [parse(Float64, x) for x in split(line)]
        push!(matrix_data, row)
    end
end

# Integration from a random point x_init
t_inter = matrix_data[1]
N = length(t_inter)
x_inter = [ [ matrix_data[i][j] for i ∈ 2:7 ] for j ∈ 1:N ]
u_inter = control_ideal.(x_inter)

N_init = 350
time_init = t_inter[N_init]
x0 = [x_inter[N_init][1:2]; x_inter[N_init][4:5]]

N_final = N

t0 = time_init
tf = t_inter[N_final]

itp1 = linear_interpolation(t_inter[N_init:N_final], [ x_inter[i][1] for i ∈ N_init:N_final ], extrapolation_bc=Line())
itp2 = linear_interpolation(t_inter[N_init:N_final], [ x_inter[i][2] for i ∈ N_init:N_final ], extrapolation_bc=Line())
itp3 = linear_interpolation(t_inter[N_init:N_final], [ x_inter[i][4] for i ∈ N_init:N_final ], extrapolation_bc=Line())
itp4 = linear_interpolation(t_inter[N_init:N_final], [ x_inter[i][5] for i ∈ N_init:N_final ], extrapolation_bc=Line())
itp_u = linear_interpolation(t_inter[N_init:N_final], u_inter[N_init:N_final], extrapolation_bc=Line())

function F0(x)
    # Kepler equation
    normr = rnorm(x[1:2])
    r = x[1:2]
    v = x[3:4]
    dv = -mu / normr^3 * r
    dx = [v; dv]
    return dx
end

function F1(x, β)
    normr = rnorm(x[1:2])
    cf = x[1] / normr
    sf = x[2] / normr
    rot_matrix = [cf -sf; sf  cf]
    dvdt = rot_matrix * srpsail2D(x, β, epsilon)
    dxdt = [0; 0; dvdt]
    return dxdt
end

function temperature(x, β)
    normr = rnorm(x[1:2])
    temp = (Tds^4 + cos(β) / ( normr ) * opt_constr * heat_constr)^(1/4)
    return temp
end

@def ocp begin
    t ∈ [ t0, tf ], time
    x ∈ R⁴, state
    β ∈ R, control
    -30 ≤ x₁(t) ≤ 30
    -30 ≤ x₂(t) ≤ 30
    -30 ≤ x₃(t) ≤ 30
    -30 ≤ x₄(t) ≤ 30
    -π/2 * 0.8 ≤ β(t) ≤ π/2 * 0.8
    x(t0) == x0
    ẋ(t) == F0(x(t)) + F1(x(t), β(t))
    cos(β(t)) / ( rnorm(x[1:2](t))) * opt_constr * heat_constr + temp_constr ≤ 0
    -mu / sqrt( rnorm(x[1:2](tf))) + 1/2 * ( x₃(tf)^2 + x₄(tf)^2 ) → max
end

x(t) = [itp1(t), itp2(t), itp3(t), itp4(t)]
β(t)  = itp_u(t)

initial_guess = (state=x, control=β)
sol = solve(ocp, init=initial_guess, grid_size = 200)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">OptimalControlSolution</code></pre><pre><code class="language-julia hljs">plot_sol = Plots.plot(sol, size=(900, 1200))</code></pre><img src="application-sail-9d3ba3b3.svg" alt="Example block output"/><pre><code class="language-julia hljs">x_sol = sol.state.(sol.times)
Nsol = length(x_sol)
plot_traj2D = Plots.plot([ x_sol[i][1] for i ∈ 1:Nsol ], [ x_sol[i][2] for i ∈ 1:Nsol ], size=(600, 600), label=&quot;direct without initial guess&quot;)
plot_traj_matlab = Plots.plot!(matrix_data[2], matrix_data[3], size=(600, 600), label=&quot;local-optimal&quot;)
scatter!([x_sol[1][1]], [x_sol[1][2]], label=&quot;beginning of the optimised arc&quot; )
scatter!([x_sol[end][1]], [x_sol[end][2]], label=&quot;end of the optimised arc&quot; )
scatter!([0], [0], label=&quot;Sun&quot;, color=&quot;yellow&quot; )</code></pre><img src="application-sail-9d4f7d23.svg" alt="Example block output"/><pre><code class="language-julia hljs">β_sol = sol.control.(sol.times)
plot_temperature = Plots.plot(sol.times, temperature.(x_sol, β_sol), size=(600, 600), label=&quot;sail temperature&quot;)
plot!([sol.times[1], sol.times[end]], [Tlim, Tlim], label=&quot;temperature limit&quot;)</code></pre><img src="application-sail-9ed78096.svg" alt="Example block output"/><pre><code class="language-julia hljs">energy_sol = -mu./sqrt.([x_sol[i][1] for i ∈ 1:Nsol].^2 + [x_sol[i][2] for i ∈ 1:Nsol].^2 ) + 1/2 * ([x_sol[i][3] for i ∈ 1:Nsol].^2 + [x_sol[i][4] for i ∈ 1:Nsol].^2)
energy_local_optimal = -mu./sqrt.(matrix_data[2].^2 + matrix_data[3].^2 + matrix_data[4].^2) + 1/2 * (matrix_data[5].^2 + matrix_data[6].^2 + matrix_data[7].^2)
plot_energy = Plots.plot(sol.times, energy_sol, size=(600, 600), label=&quot;orbital energy&quot;)
plot!(matrix_data[1][N_init:N], energy_local_optimal[N_init:N], label=&quot;orbital energy, local-optimal&quot;)</code></pre><img src="application-sail-0eda8aa1.svg" alt="Example block output"/><pre><code class="language-julia hljs">###########################################################################################################################################
#                           CONTINUATION ON T0
###########################################################################################################################################

function ocp_t0(N_0, N_f)
    global t0 = t_inter[N_0]
    global tf = t_inter[N_f]
    global x0 = [x_inter[N_0][1:2]; x_inter[N_0][4:5]]
    @def ocp begin
        t ∈ [ t0, tf ], time
        x ∈ R⁴, state
        β ∈ R, control
        -30 ≤ x₁(t) ≤ 30
        -30 ≤ x₂(t) ≤ 30
        -30 ≤ x₃(t) ≤ 30
        -30 ≤ x₄(t) ≤ 30
        -π/2 * 0.8 ≤ β(t) ≤ π/2 * 0.8
        x(t0) == x0
        ẋ(t) == F0(x(t)) + F1(x(t), β(t))
        cos(β(t)) / ( x₁(t)^2 + x₂(t)^2 + 1e-3^2) * opt_constr * heat_constr + temp_constr ≤ 0
        -mu / sqrt( x₁(tf)^2 + x₂(tf)^2 + 1e-3^2) + 1/2 * ( x₃(tf)^2 + x₄(tf)^2 ) → max
    end
    return ocp
end

function fun_plot_sol(sol)
    x_sol = sol.state.(sol.times)
    Nsol = length(x_sol)
    plot_traj2D = Plots.plot([ x_sol[i][1] for i ∈ 1:Nsol ], [ x_sol[i][2] for i ∈ 1:Nsol ], size=(600, 600), label=&quot;direct without initial guess&quot;)
    Plots.plot!(matrix_data[2], matrix_data[3], size=(600, 600), label=&quot;local-optimal&quot;)
    scatter!([x_sol[1][1]], [x_sol[1][2]], label=&quot;beginning of the optimised arc&quot; )
    scatter!([x_sol[end][1]], [x_sol[end][2]], label=&quot;end of the optimised arc&quot; )
    scatter!([0], [0], label=&quot;Sun&quot;, color=&quot;yellow&quot; )
    return plot_traj2D
end

init_loop = sol
sol_list = []
@gif for Nt0_local = N_init:-10:N_init-50
    ocp_loop = ocp_t0(Nt0_local, N)
    global sol_loop = solve(ocp_loop, init=init_loop, grid_size = 150, print_level=0)
    global init_loop = sol_loop
    println(&quot;Time: $(Nt0_local), Objective: $(sol_loop.objective), Iteration: $(sol_loop.iterations)&quot;)
    p = fun_plot_sol(sol_loop)
    display(p)
    push!(sol_list, sol_loop)
end</code></pre><img src="application-sail-9b8cc2f0.gif" alt="Example block output"/><pre><code class="language-julia hljs">sol = sol_list[end]
fun_plot_sol(sol)
x_sol = sol.state.(sol.times)
Nsol = length(x_sol)
energy_sol = -mu./sqrt.([x_sol[i][1] for i ∈ 1:Nsol].^2 + [x_sol[i][2] for i ∈ 1:Nsol].^2 ) + 1/2 * ([x_sol[i][3] for i ∈ 1:Nsol].^2 + [x_sol[i][4] for i ∈ 1:Nsol].^2)
plot_energy = Plots.plot(sol.times, energy_sol, size=(600, 600), label=&quot;orbital energy&quot;)
plot!(matrix_data[1][N_init-50:N], energy_local_optimal[N_init-50:N], label=&quot;orbital energy, local-optimal&quot;)</code></pre><img src="application-sail-124b1235.svg" alt="Example block output"/><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="application-orbit.html">« Minimum time orbit transfer</a><a class="docs-footer-nextpage" href="application-surface-revolution.html">Catenoid solution »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Thursday 11 July 2024 15:15">Thursday 11 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
