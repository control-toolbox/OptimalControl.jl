<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Batch processing · OptimalControl.jl</title><meta name="title" content="Batch processing · OptimalControl.jl"/><meta property="og:title" content="Batch processing · OptimalControl.jl"/><meta property="twitter:title" content="Batch processing · OptimalControl.jl"/><meta name="description" content="Documentation for OptimalControl.jl."/><meta property="og:description" content="Documentation for OptimalControl.jl."/><meta property="twitter:description" content="Documentation for OptimalControl.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">OptimalControl.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="tutorial-basic-example.html">Basic example</a></li><li><a class="tocitem" href="tutorial-basic-example-f.html">Basic example (functional version)</a></li><li><a class="tocitem" href="tutorial-double-integrator.html">Double integrator: time minimisation</a></li><li><a class="tocitem" href="tutorial-initial-guess.html">Initial guess options</a></li><li><a class="tocitem" href="tutorial-continuation.html">Discrete continuation</a></li><li><a class="tocitem" href="tutorial-nlp.html">NLP and DOCP manipulations</a></li><li><a class="tocitem" href="tutorial-plot.html">Plot a solution</a></li><li><a class="tocitem" href="tutorial-lqr-basic.html">LQR example</a></li><li><a class="tocitem" href="tutorial-iss.html">Indirect simple shooting</a></li><li><a class="tocitem" href="tutorial-goddard.html">Goddard problem</a></li></ul></li><li><span class="tocitem">Applications</span><ul><li class="is-active"><a class="tocitem" href="application-batch.html">Batch processing</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Biomass-maximisation"><span>Biomass maximisation</span></a></li><li><a class="tocitem" href="#Direct-solve"><span>Direct solve</span></a></li><li><a class="tocitem" href="#Plotting"><span>Plotting</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="application-orbit.html">Minimum time orbit transfer</a></li><li><a class="tocitem" href="application-sail.html">Solar sail</a></li><li><a class="tocitem" href="application-surface-revolution.html">The surface of revolution of minimum area</a></li><li><a class="tocitem" href="application-mri-saturation.html">The saturation problem in Magnetic Resonance Imaging</a></li></ul></li><li><a class="tocitem" href="fgs-2024.html">FGS 2024</a></li><li><a class="tocitem" href="juliacon2024.html">JuliaCon 2024</a></li><li><a class="tocitem" href="api.html">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Applications</a></li><li class="is-active"><a href="application-batch.html">Batch processing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="application-batch.html">Batch processing</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/control-toolbox/OptimalControl.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/control-toolbox/OptimalControl.jl/blob/main/docs/src/application-batch.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="batch"><a class="docs-heading-anchor" href="#batch">Batch processing</a><a id="batch-1"></a><a class="docs-heading-anchor-permalink" href="#batch" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>Let us consider a <em>self-replicator</em> model <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> describing the dynamics of a microbial population growing inside a closed bioreactor. The bacterial culture has a constant volume. At the beginning of the experience, there is an initial mass of substrate <span>$S$</span> inside the bioreactor, that is gradually consumed by the bacterial population, and transformed into precursor metabolites <span>$P$</span>. These precursors are intermediate metabolites used to produce proteins—such as ribosomes and enzymes—responsible for specific cellular functions; and metabolites of interest <span>$X$</span> which are excreted from the cell. The proteins forming bacterial cells are divided into three classes <span>$M$</span>, <span>$R$</span> and <span>$Q$</span>, associated with the following cellular functions:</p><ul><li>class <span>$M$</span> proteins of the metabolic machinery, responsible for the uptake of nutrients,</li><li>class <span>$S$</span> from the medium (substrate),</li><li>the production of precursor metabolites <span>$P$</span>,</li><li>and the synthesis of metabolites of interest <span>$X$</span>.</li></ul><p>Class <span>$R$</span> proteins of the gene expression machinery (such as ribosomes) actively involved in protein biosynthesis (<em>i.e.</em> in the production of proteins of classes <span>$M$</span>, <span>$Q$</span> and <span>$R$</span>). Class <span>$Q$</span> Growth are rate-independent proteins, such as housekeeping proteins responsible for cell maintenance, and ribosomes not involved in protein synthesis. There is an <em>internal</em> control, <span>$\alpha$</span>, accounting for the behaviour of each individual cell that has to decide between two pathways (transforming precursors <span>$P$</span> into metabolites <span>$M$</span> or into ribosomes <span>$R$</span>), and one <em>external</em> control leveraging the production of the product <span>$X$</span> (for instance using a light induced control of bioengineered cells).</p><img src="./assets/batch.jpg" style="display: block; margin: 0 auto 20px auto;" width="400px"><p>After some normalisations, a simplified version of the system (not describing the production of metabolite as we will focus on volume maximisation on this example) can be written in terms of the concentrations of the substrate <span>$s$</span>, precursors <span>$p$</span>, ribosomes <span>$r$</span>, and the of the volume <span>$V$</span> of the bacterial population.<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup> Accordingly, the state <span>$\varphi=(s,p,r,V)$</span> is four-dimensional, and there is only one control, <span>$\alpha$</span>:</p><p class="math-container">\[\begin{align*}
  \dot{s} &amp;= -w_M(s)(1-r)V,\\
  \dot{p} &amp;= w_M(s)(1-r) - w_R(p)r(p+1),\\
  \dot{r} &amp;= (\alpha-r)w_R(p)r,\\
  \dot{V} &amp;= w_R(p)rV,
\end{align*}\]</p><p>where velocities are taken linear in the concentrations, and where Michaelis-Menten kinetics are assumed:</p><p class="math-container">\[v_R := V_R/V = w_R(p) r,\quad v_M := V_M/V = w_M(s) m,\]</p><p>with</p><p class="math-container">\[w_R(p) = \frac{k_R\,p}{K_r + p}\,, \quad w_M(s) = \frac{k_m s}{K_m + s}\cdot\]</p><h2 id="Biomass-maximisation"><a class="docs-heading-anchor" href="#Biomass-maximisation">Biomass maximisation</a><a id="Biomass-maximisation-1"></a><a class="docs-heading-anchor-permalink" href="#Biomass-maximisation" title="Permalink"></a></h2><p>We first import the needed packages.</p><pre><code class="language-julia hljs">using OptimalControl
using NLPModelsIpopt
using Plots</code></pre><p>We are interested in maximising the biomass production <sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup> (final volume of the bacterial population) over a finite time horizon <span>$[0,t_f]$</span>. To solve the problem, we first set up the boundary values,</p><pre><code class="language-julia hljs">t0 = 0
tf = 90
s0 = 0.1
p0 = 0.001
r0 = 0.1
V0 = 0.003</code></pre><p>together with parameters and auxiliary functions definnig the synthesis rates:</p><pre><code class="language-julia hljs">kᵣ = 1.1
kₘ = 1.2
Kᵣ = 1.3
Kₘ = 1.4

wᵣ(p) = kᵣ * p / (Kᵣ + p)
wₘ(s) = kₘ * s / (Kₘ + s)</code></pre><p>Then we define the optimal control problem setting time, state, control, boundary conditions, state and control constraints, dynamics and Mayer cost:</p><pre><code class="language-julia hljs">@def batch begin

    t ∈ [ t0, tf ], time
    φ = (s, p, r, V) ∈ R⁴, state
    α ∈ R, control

    s(t0) == s0
    p(t0) == p0
    r(t0) == r0
    V(t0) == V0

    s(t) ≥ 0
    p(t) ≥ 0
    0 ≤ r(t) ≤ 1
    V(t) ≥ 0
    0 ≤ α(t) ≤ 1

    φ̇(t) == F0(s(t), p(t), r(t), V(t)) + α(t) * F1(s(t), p(t), r(t), V(t))

    V(tf) → max

end</code></pre><p>The dynamics is indeed affine in the control, <span>$\dot{\varphi} = F_0(\varphi) + \alpha F_1(\varphi)$</span>, with vector fields</p><pre><code class="language-julia hljs">F0(s, p, r, V) =
    [ -wₘ(s) * (1 - r) * V
       wₘ(s) * (1 - r) - wᵣ(p) * r * (p + 1)
      -wᵣ(p) * r^2
       wᵣ(p) * r * V ]

F1(s, p, r, V) = [ 0, 0, wᵣ(p) * r, 0 ]</code></pre><h2 id="Direct-solve"><a class="docs-heading-anchor" href="#Direct-solve">Direct solve</a><a id="Direct-solve-1"></a><a class="docs-heading-anchor-permalink" href="#Direct-solve" title="Permalink"></a></h2><p>Since the following result holds,<sup class="footnote-reference"><a id="citeref-4" href="#footnote-4">[4]</a></sup></p><p><strong>Proposition.</strong> <em>The Lie bracket <span>$F_{101}$</span> belongs to the span of <span>$F_1$</span> and <span>$F_{01}$</span>, so singular controls are at least of local order two.</em></p><p>one expects singular arcs connected with bang arcs through Fuller phenomenon (accumulation of switching times).</p><p>We first solve the problem using a uniform discretisation:</p><pre><code class="language-julia hljs">sol0  = solve(batch; grid_size=1000, print_level=0)
println(&quot;Objective &quot;, sol0.objective, &quot; after &quot;, sol0.iterations, &quot; iterations&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Method = (:direct, :adnlp, :ipopt)
Objective 0.07683200113875356 after 111 iterations</code></pre><p>Although convergence is obtained, it is actually more efficient to first solve on a raw grid, then use a <em>warm start</em> to solve again on a finer (still uniform) grid:</p><pre><code class="language-julia hljs">sol1 = solve(batch; grid_size=20, print_level=0)
println(&quot;Objective &quot;, sol1.objective, &quot; after &quot;, sol1.iterations, &quot; iterations&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Method = (:direct, :adnlp, :ipopt)
Objective 0.0769994219213667 after 31 iterations</code></pre><pre><code class="language-julia hljs">sol2 = solve(batch; grid_size=1000, print_level=0, init=sol1)
println(&quot;Objective &quot;, sol2.objective, &quot; after &quot;, sol2.iterations, &quot; iterations&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Method = (:direct, :adnlp, :ipopt)
Objective 0.07683200113876136 after 22 iterations</code></pre><h2 id="Plotting"><a class="docs-heading-anchor" href="#Plotting">Plotting</a><a id="Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting" title="Permalink"></a></h2><p>We eventually plot the solutions (raw grid + finer grid) and observe that the control exhibits the expected structure with a Fuller-in arc followed by a singular one, then a Fuller-out arc:</p><pre><code class="language-julia hljs">plot(sol1; solution_label=&quot;(N=20)&quot;, size=(800, 1000))     # N is the grid size
plot!(sol2; solution_label=&quot;(N=1000)&quot;)</code></pre><img src="application-batch-1a09652b.svg" alt="Example block output"/><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Giordano, N.; Mairet, F.; Gouzé, J.-L.; Geiselmann, J.; De Jong, H. Dynamical allocation of cellular resources as an optimal control problem: novel insights into microbial growth strategies. <em>PLoS comp. biol.</em> <strong>12</strong> (2016), e1004802. </li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Yabo, A. G.; Caillau, J.-B.; Gouzé, J.-L.; de Jong, H.; Mairet, F. Dynamical analysis and optimization of a generalized resource allocation model of microbial growth. <em>SIAM J. Appl. Dyn. Syst.</em> <strong>21</strong> (2022), no. 1, 137-165.</li><li class="footnote" id="footnote-3"><a class="tag is-link" href="#citeref-3">3</a>Yabo, A. G.; Caillau, J.-B.; Gouzé, J.-L. Optimal bacterial resource allocation strategies in batch processing. <em>SIAM J. Appl. Dyn. Syst.</em>, to appear.</li><li class="footnote" id="footnote-4"><a class="tag is-link" href="#citeref-4">4</a>Astruc, L.; Edery, N. Optimal allocation of bacterial resources in a bioreactor. Project report, Polytech Nice Sophia, Université Côte d&#39;Azur (2023).</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="tutorial-goddard.html">« Goddard problem</a><a class="docs-footer-nextpage" href="application-orbit.html">Minimum time orbit transfer »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Wednesday 10 July 2024 11:59">Wednesday 10 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
