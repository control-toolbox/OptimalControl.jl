<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>NLP and DOCP manipulations · OptimalControl.jl</title><meta name="title" content="NLP and DOCP manipulations · OptimalControl.jl"/><meta property="og:title" content="NLP and DOCP manipulations · OptimalControl.jl"/><meta property="twitter:title" content="NLP and DOCP manipulations · OptimalControl.jl"/><meta name="description" content="Documentation for OptimalControl.jl."/><meta property="og:description" content="Documentation for OptimalControl.jl."/><meta property="twitter:description" content="Documentation for OptimalControl.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="https://control-toolbox.org/assets/css/documentation.css" rel="stylesheet" type="text/css"/><script src="https://control-toolbox.org/assets/js/documentation.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">OptimalControl.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="tutorial-basic-example.html">Basic example</a></li><li><a class="tocitem" href="tutorial-basic-example-f.html">Basic example (functional version)</a></li><li><a class="tocitem" href="tutorial-double-integrator.html">Double integrator: time minimisation</a></li><li><a class="tocitem" href="tutorial-initial-guess.html">Initial guess options</a></li><li><a class="tocitem" href="tutorial-continuation.html">Discrete continuation</a></li><li class="is-active"><a class="tocitem" href="tutorial-nlp.html">NLP and DOCP manipulations</a><ul class="internal"><li><a class="tocitem" href="#Definition-of-the-optimal-control-problem"><span>Definition of the optimal control problem</span></a></li><li><a class="tocitem" href="#Discretization-and-NLP-problem"><span>Discretization and NLP problem</span></a></li><li><a class="tocitem" href="#Resolution-of-the-NLP-problem"><span>Resolution of the NLP problem</span></a></li><li><a class="tocitem" href="#Initial-guess"><span>Initial guess</span></a></li></ul></li><li><a class="tocitem" href="tutorial-plot.html">Plot a solution</a></li><li><a class="tocitem" href="tutorial-lqr-basic.html">LQR example</a></li><li><a class="tocitem" href="tutorial-iss.html">Indirect simple shooting</a></li><li><a class="tocitem" href="tutorial-goddard.html">Goddard problem</a></li></ul></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="api-optimalcontrol.html">OptimalControl.jl</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Subpackages</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="api-ctbase.html">CTBase.jl</a></li><li><a class="tocitem" href="api-ctdirect.html">CTDirect.jl</a></li><li><a class="tocitem" href="api-ctflows.html">CTFlows.jl</a></li></ul></li></ul></li><li><span class="tocitem">Developers</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Subpackages</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="dev-ctbase.html">CTBase.jl</a></li><li><a class="tocitem" href="dev-ctdirect.html">CTDirect.jl</a></li><li><a class="tocitem" href="dev-ctflows.html">CTFlows.jl</a></li></ul></li></ul></li><li><a class="tocitem" href="juliacon2024.html">JuliaCon 2024</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href="tutorial-nlp.html">NLP and DOCP manipulations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="tutorial-nlp.html">NLP and DOCP manipulations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/control-toolbox/OptimalControl.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/control-toolbox/OptimalControl.jl/blob/main/docs/src/tutorial-nlp.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="NLP-and-DOCP-manipulations"><a class="docs-heading-anchor" href="#NLP-and-DOCP-manipulations">NLP and DOCP manipulations</a><a id="NLP-and-DOCP-manipulations-1"></a><a class="docs-heading-anchor-permalink" href="#NLP-and-DOCP-manipulations" title="Permalink"></a></h1><p>We describe here some more advanced operations related to the discretized optimal control problem. When calling <code>solve(ocp)</code> three steps are performed internally:</p><ul><li>first, the OCP is discretized into a DOCP (a nonlinear optimization problem) with <a href="api-ctdirect.html#CTDirect.direct_transcription-Tuple{OptimalControlModel, Vararg{Any}}"><code>direct_transcription</code></a>,</li><li>then, this DOCP is solved (with the internal function <code>solve_docp</code>),</li><li>finally, a functional solution of the OCP is rebuilt from the solution of the discretized problem, with <a href="api-ctdirect.html#CTDirect.build_solution-Tuple{Any, Any}"><code>build_solution</code></a>.</li></ul><p>These steps can also be done separately, for instance if you want to use your own NLP solver. </p><p>Let us load the packages.</p><pre><code class="language-julia hljs">using OptimalControl
using NLPModelsIpopt
using Plots</code></pre><h2 id="Definition-of-the-optimal-control-problem"><a class="docs-heading-anchor" href="#Definition-of-the-optimal-control-problem">Definition of the optimal control problem</a><a id="Definition-of-the-optimal-control-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Definition-of-the-optimal-control-problem" title="Permalink"></a></h2><p>We define a test problem</p><pre><code class="language-julia hljs">@def ocp begin

    t ∈ [ 0, 1 ], time
    x ∈ R², state
    u ∈ R, control

    x(0) == [ -1, 0 ]
    x(1) == [ 0, 0 ]

    ẋ(t) == [ x₂(t), u(t) ]

    ∫( 0.5u(t)^2 ) → min

end</code></pre><h2 id="Discretization-and-NLP-problem"><a class="docs-heading-anchor" href="#Discretization-and-NLP-problem">Discretization and NLP problem</a><a id="Discretization-and-NLP-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Discretization-and-NLP-problem" title="Permalink"></a></h2><p>We discretize the problem.</p><pre><code class="language-julia hljs">docp, nlp = direct_transcription(ocp)</code></pre><p>The DOCP contains information related to the transcription, including a copy of the original OCP, and the NLP is the resulting discretized problem, in our case an <code>ADNLPModel</code>.</p><p>We can now use the solver of our choice to solve it.</p><h2 id="Resolution-of-the-NLP-problem"><a class="docs-heading-anchor" href="#Resolution-of-the-NLP-problem">Resolution of the NLP problem</a><a id="Resolution-of-the-NLP-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Resolution-of-the-NLP-problem" title="Permalink"></a></h2><p>For a first example we use the <code>ipopt</code> solver from <a href="https://github.com/JuliaSmoothOptimizers/NLPModelsIpopt.jl"><code>NLPModelsIpopt.jl</code></a> package to solve the NLP problem.</p><pre><code class="language-julia hljs">using NLPModelsIpopt
nlp_sol = ipopt(nlp; print_level=4, mu_strategy=&quot;adaptive&quot;, tol=1e-8, sb=&quot;yes&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Total number of variables............................:      404
                     variables with only lower bounds:        0
                variables with lower and upper bounds:        0
                     variables with only upper bounds:        0
Total number of equality constraints.................:      305
Total number of inequality constraints...............:        0
        inequality constraints with only lower bounds:        0
   inequality constraints with lower and upper bounds:        0
        inequality constraints with only upper bounds:        0


Number of Iterations....: 2

                                   (scaled)                 (unscaled)
Objective...............:   6.0023829460295737e+00    6.0023829460295737e+00
Dual infeasibility......:   1.7763568394002505e-15    1.7763568394002505e-15
Constraint violation....:   8.8817841970012523e-16    8.8817841970012523e-16
Variable bound violation:   0.0000000000000000e+00    0.0000000000000000e+00
Complementarity.........:   0.0000000000000000e+00    0.0000000000000000e+00
Overall NLP error.......:   1.7763568394002505e-15    1.7763568394002505e-15


Number of objective function evaluations             = 3
Number of objective gradient evaluations             = 3
Number of equality constraint evaluations            = 3
Number of inequality constraint evaluations          = 0
Number of equality constraint Jacobian evaluations   = 3
Number of inequality constraint Jacobian evaluations = 0
Number of Lagrangian Hessian evaluations             = 2
Total seconds in IPOPT                               = 0.023

EXIT: Optimal Solution Found.</code></pre><p>Then we can rebuild and plot an optimal control problem solution (note that the multipliers are optional, but the OCP costate will not be retrieved if the multipliers are not provided).</p><pre><code class="language-julia hljs">sol = build_solution(docp, primal=nlp_sol.solution, dual=nlp_sol.multipliers)
plot(sol)</code></pre><img src="tutorial-nlp-255472b9.svg" alt="Example block output"/><h2 id="Initial-guess"><a class="docs-heading-anchor" href="#Initial-guess">Initial guess</a><a id="Initial-guess-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-guess" title="Permalink"></a></h2><p>An initial guess, including warm start, can be passed to <a href="api-ctdirect.html#CTDirect.direct_transcription-Tuple{OptimalControlModel, Vararg{Any}}"><code>direct_transcription</code></a> the same way as for <code>solve</code>.</p><pre><code class="language-julia hljs">docp, nlp = direct_transcription(ocp, init=sol)</code></pre><p>It can also be changed after the transcription is done, with  <a href="api-ctdirect.html#CTDirect.set_initial_guess-Tuple{DOCP, Any, Any}"><code>set_initial_guess</code></a>.</p><pre><code class="language-julia hljs">set_initial_guess(docp, nlp, sol)</code></pre><p>For a second example, we use the <a href="https://jso.dev/Percival.jl"><code>Percival.jl</code></a> to solve the NLP problem with as initial guess the solution from the first resolution.</p><pre><code class="language-julia hljs">using Percival

output = percival(nlp)
print(output)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Generic Execution stats
  status: maximum elapsed time
  objective value: 5.914803412509069
  primal feasibility: 0.0006955178574251409
  dual feasibility: 0.01892696601981937
  solution: [-0.9999339345007777  3.303297411031062e-5  1.12604105523349e-11  5.89884792541612 ⋯ -5.898847971179029]
  multipliers: [-11.256209549856733  -5.571821459345133  1.0000003660909307  -11.256209549847862 ⋯ 1.0000001126041056]
  iterations: 7
  elapsed time: 30.00352191925049</code></pre><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="tutorial-continuation.html">« Discrete continuation</a><a class="docs-footer-nextpage" href="tutorial-plot.html">Plot a solution »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Saturday 3 August 2024 07:22">Saturday 3 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
